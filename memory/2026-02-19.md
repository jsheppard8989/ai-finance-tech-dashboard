# 2026-02-19

## Pipeline Audit & Overhaul

### What Was Broken
1. **Approval workflow was dead** — `morning_curator.py` sent iMessage but nothing ever received Jared's reply. `approval_processor.py` required manual CLI invocation. Completely dysfunctional.
2. **5 transcripts sitting unanalyzed since Feb 18** — fetched + transcribed but never sent through AI analysis
3. **`newsletters` table was empty** — inbox/ had 7 JSON files, none imported
4. **`weighted_score` = 0 on all ticker_mentions** — never set at insert time, so scoring was broken
5. **`is_processed` / `added_to_site` never flipped** — episodes in DB but not recognized as done

### What Was Fixed
1. **Built `auto_pipeline.py`** — fully automated, no approval step, runs end-to-end with notification after
2. **Rebuilt cron schedule:**
   - 10pm: Full pipeline (fetch + transcribe + analyze + export + push)
   - 7am: Analysis-only (assumes 10pm transcribed; analyzes + exports + pushes + sends iMessage summary to Jared)
   - 12pm: Price refresh only
3. **Manually analyzed 5 pending transcripts** (via sub-agent using Moonshot API)
4. **Manually wrote 5 insight cards** with real editorial content:
   - Dario Amodei: Near End of the Exponential
   - Jack Mallers: Japan, AI & Bitcoin Liquidity Shock
   - Paul Krugman: Dollar Resilience & AI Deflation Risk
   - Sam Altman: AI CEO Vision / 5-Year Plans Obsolete
   - Noor Siddiqui: Orchard & Genetic Health Revolution
5. **Fixed `add_ticker_mention()`** — now calculates weighted_score at insert
6. **Seeded 17 ticker mentions** from new episodes: BTC, NVDA, MSFT, GOOGL, MSTR, COIN, etc.
7. **Pushed to GitHub Pages** — website now live with new content

### Known Remaining Issues
- `analyze_transcript.py` has a DB cursor bug (`_GeneratorContextManager has no cursor`) — fix needed in `analyze_transcript.py` where it calls `db._get_connection()` directly instead of using `with`
- Ticker extraction from AI analysis currently returns 0 mentions per episode — the `process_all_transcripts()` function isn't properly calling `add_ticker_mention()`. Need to audit `analyze_transcript.py` ticker extraction path.
- Newsletter ingestion from Gmail still needs Gmail App Password in `.env` to work

### To Do Next Session
- Fix `analyze_transcript.py` cursor bug so ticker mentions are auto-extracted
- Verify tomorrow's 7am job fires correctly and Jared gets an iMessage
- Check website live at the domain to confirm 5 new insights visible
